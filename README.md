# 💰리뷰 데이터 파이프라인 구축과 모델 개발
사용자가 직접 작성한 리뷰를 수집하여 데이터베이스에 적재하고, 자연어처리를 통해 감정 분석하기 위한 모델 개발.
- 프로젝트 기간 : 2023.03.09 ~ 2023.03.13
- skills : ```Python``` ```Docker``` ```MongoDB``` ```Metabase```

* 기술 스택 선택 이유
  * ```Docker``` : MongoDB Atlas와 Metabase 간에 독립적인 환경이 생성되기 때문에 의존성이 줄어들고 서로의 환경에 영향을 미치지 않아 더 안정적이고 신뢰성있는 서비스 구축 가능.
  * ```MongoDB```
    * 리뷰 텍스트는 비정형 데이터이므로 다양한 유형의 데이터 저장이 가능한 MongoDB 선택.
    * 수평 확장이 쉽고, 빠른 읽기/ 쓰기 처리를 지원하기 때문에 대용량 데이터를 처리하는데 유리함.
    
<br>

### 1. 프로젝트 개요
- 단순히 별점으로만 상품에 대해서 평가하는 것이 아닌 사용자들이 직접 작성한 대용량의 리뷰를 수집하고 적재하는 데이터 파이프라인을 구축하고 시각화 도구를 결합하여 의사결정에 활용하는데 도움을 주고자 함.
- 사용자들이 직접 작성한 리뷰를 자연어처리를 통해 감정 분석해보고 이를 통해 고객의 의견을 이해하고 제품 개선 및 마케팅 전략 수립에 활용함으로써, 해당 브랜드에게 분석 내용을 공유하여 매출 극대화를 시키기 위함.

<br>

### 2. 프로젝트 수행절차  
#### 2.1. 데이터 소개

<br>

* 무신사 홈페이지에서 리뷰 데이터 크롤링 (BeautifulSoup사용 _ robots.txt 확인 완료.)   
  데이터 : 33392 rows × 11 columns

<br>

|Columns|Dtype|
|--------|-------|
|user_level|object|
|user_name|object|
|user_sex|object|
|user_height|object|
|user_weight|object|
|brand|object|
|product|object|
|date|object|
|starss|object|
|Review|object|
|link|object|

<br>

* 네이버 쇼핑 홈페이지에서 제품별 후기와 별점이 수집된 데이터. – 모델 학습용 데이터   
  데이터 : 200000 rows × 2 columns

<br>

|Columns|Dtype|
|--------|-------|
|rating|int|
|Review|object|

<br>

#### 2.2. 파이프라인 소개
![image](https://github.com/KIMJEONGSU/js_portfolio/assets/23291338/454524aa-6e59-42e3-8e1b-fd84825e4543)
  
<br>

#### 2.3. 데이터 전처리
* Musinsa 데이터 전처리
  *  별점이 4,5 점이면 1(만족) 1,2,3 점이면 0(불만족) 으로 분류
  *  리뷰가 Null이거나 No Review인 경우 삭제.
  *  Musinsa 데이터는 여기까지만 진행. 추후에 모델에 실제 Musinsa Review를 넣어 예측해볼 예정.
* 네이버 데이터 전처리
  * Rating
    * 데이터 타입을 object -> int 로 변경
    * 별점이 4,5 점이면 만족 그외에는 불만족으로 분류
  * Review
    * 중복된 리뷰 텍스트 삭제
    * 영어와 자음, 모음 각각 제거하는 정규식 적용
    * 숫자만 있는 경우와 숫자+한글(ex.1명만) 인경우 정규식으로 제거.
* 형태소 분석
  * 형태소 분석기 중 Okt 를 사용했고, 한글 불용어는 파이썬 라이브러리가 없어서 직접 불용어 사전을 만들어 제거(stopwords.txt)
    ![image](https://user-images.githubusercontent.com/23291338/235723982-294de4d9-ceca-4434-96b2-2acd07a3deec.png)
* 토큰화, 패딩 진행.

<br>

#### 2.4. 가설설정
- Musinsa Data에서는 부정 리뷰가 1.77% 였지만, 실제 리뷰 분석 시 그 이상일 것이다.

#### 2.5. 모델 학습 및 평가, 가설검증
* MLP, LSTM, CNN 3가지 모델을 활용하여 모델학습 진행
  * version 2에서는 LSTM모델만을 활용.  
* EarlyStopping : validation loss가 4 epoch 연속으로 감소하지 않을 경우 학습을 멈추도록 설정
* 모델 컴파일
  * 이진 분류 문제이기 때문에 'binary_crossentropy’ 손실함수 사용.
  * 최적화 알고리즘으로 adam 사용.
  * 불균형한 데이터가 아니기 때문에 평가지표로 정확도 사용.
* 평가
  * 불만족인데 만족이라고 판단하는 에러가 적어야하기 때문에 추가로 정밀도 평가지표를 사용.   
  * 정확도와 정밀도가 가장 높았던 LSTM을 최종모델로 선택. 
  * 학습된 모델을 활용하여 가설 검증.
  * 보통 별점을 1점 주고 좋은 리뷰를 작성하진 않습니다. 하지만 별점이 5점인 경우 리뷰 내용이 정말 좋은지 체크해볼 필요가 있습니다.

<br>

|별점|내용|예측결과|자체평가|
|-------------|---------------|-----------|---|
|5|착용감이 매우 만족스럽고 어디에나 코디하기 좋아요|97.58% 확률로 긍정 리뷰입니다.|해당 문장은 긍정으로 잘 예측했으나, 동일한 문장이 3개 있음에도 불구하고 모두 다른 퍼센트가 나옴.|
|5|벨트 줄이 생각보다 어어엄청 길어가지고 좀 당황했는대 구멍뚫어서 잘쓰고있어요|99.30% 확률로 부정 리뷰입니다.|어느 정도 부정이 있지만, 99%의 확률로 부정이라고 예측한 결과는 잘못 나온 것이라 판단됨.|
|5|수납공간도 넉넉하고 가볍게 가지고 다니기 좋아요 무엇보다 독특한 패턴이 제일 맘에 드는 것 같아요완죠니 동글동글|99.98% 활률로 부정 리뷰입니다.|객관적으로 봤을때, 긍정문장이지만 99%확률로 부정으로 예측함.|
|5|요즘 내 피부처럼 입는 옷 진짜 만족도 최고 앞으로도 이것만 구비할 예정|99.66% 확률로 부정 리뷰입니다.|객관적으로 봤을때, 긍정문장이지만 99%확률로 부정으로 예측함.|

<br>

* 가설 검증 : 결과적으로 부정 리뷰가 46%를 차지하고 있었다. (가설 채택)

<br>

### 3. 결과
* 긍정인 리뷰를 분석하여 사용자들은 어떤 점에서 만족을 느꼈는지 조사할 필요가 있고, 부정인 리뷰 또한 마찬가지로 어떤 점에서 불만족을 느꼈는지 조사하여 문제를 개선하는데 참고한다면 더 나은 만족도를 제공할 수 있을 것으로 예상.
* 대시보드
![스크린샷 2023-07-13 223941](https://github.com/KIMJEONGSU/js_portfolio/assets/23291338/38d603c6-88e8-4651-ba21-f04fa271f107)
  
<br>

### 4. 한계점 및 개선사항
* 한계점
  * 2022년 Musinsa Review data를 모두 크롤링하기엔 시간적 제한이 있었음.
  * 데이터 가공 후 데이터 웨어하우스에 저장하지 못하여 ELT 파이프라인 구축을 하지 못한 점.
  * 전처리와 불용어를 어떻게 제거하느냐에 따라 성능 차이가 있음을 확인했지만, 모든 경우의 수를 확인하지 못한 점.
* 개선사항
  * 2022년 전체가 아닌 각 월의 일부 데이터만 크롤링했기 때문에 Apache Spark를 통해 배치 프로세싱을 수행하여 추가로 데이터를 수집할 필요가 있음.
  * MongoDB에 적재 후 가공하여 데이터 웨어하우스에 적재하여 BI와 결합하여 의사결정에 도움이 되도록 구축.
  * 파이프라인 모니터링을 위해 Airflow를 사용하려고 했지만, DAG을 만족하지 않아 파이프라인 수정 필요.

